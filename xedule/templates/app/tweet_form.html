<!-- templates/app/tweet_form.html -->
{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block title %}
  {% if object %}
    Edit Tweet
  {% else %}
    New Tweet
  {% endif %}
{% endblock title %}
{% block content %}
  <div class="row mb-4">
    <div class="col">
      <h1 class="h4 fw-bold">
        {% if object %}
          Edit Tweet
        {% else %}
          New Tweet
        {% endif %}
      </h1>
    </div>
    <div class="col-auto">
      <a href="{% url 'tweet_list' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back
      </a>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="{{ form.content.id_for_label }}" class="form-label">What's happening?</label>
          <textarea name="{{ form.content.name }}"
                    id="{{ form.content.id_for_label }}"
                    class="form-control"
                    rows="4"
                    maxlength="280"
                    required>{% if form.content.value %}{{ form.content.value }}{% endif %}</textarea>
          <div class="d-flex justify-content-between mt-1">
            <div class="form-text">{{ form.content.help_text }}</div>
            <div class="form-text">
              <span id="charCount">0</span>/280
            </div>
          </div>
          {% if form.content.errors %}
            <div class="text-danger">
              {% for error in form.content.errors %}{{ error }}{% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label for="{{ form.scheduled_time.id_for_label }}" class="form-label">When to post</label>
          <input type="datetime-local"
                 name="{{ form.scheduled_time.name }}"
                 id="{{ form.scheduled_time.id_for_label }}"
                 class="form-control"
                 value="{% if form.scheduled_time.value %}{{ form.scheduled_time.value|date:'Y-m-d\TH:i' }}{% endif %}"
                 required />
          <div class="form-text">{{ form.scheduled_time.help_text }}</div>
          {% if form.scheduled_time.errors %}
            <div class="text-danger">
              {% for error in form.scheduled_time.errors %}{{ error }}{% endfor %}
            </div>
          {% endif %}
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-calendar-check"></i>
          {% if object %}
            Update Tweet
          {% else %}
            Schedule Tweet
          {% endif %}
        </button>
      </form>
    </div>
  </div>
{% endblock content %}
{% block javascript %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const textarea = document.getElementById('{{ form.content.id_for_label }}');
      const charCount = document.getElementById('charCount');

      function updateCharCount() {
        const count = textarea.value.length;
        charCount.textContent = count;

        if (count > 280) {
          charCount.classList.add('text-danger');
        } else {
          charCount.classList.remove('text-danger');
        }
      }

      // Initial count
      updateCharCount();

      // Update on input
      textarea.addEventListener('input', updateCharCount);
    });
  </script>
{% endblock javascript %}
