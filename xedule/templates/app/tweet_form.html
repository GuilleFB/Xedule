<!-- templates/tweets/tweet_form.html -->
{% extends 'base.html' %}

{% block title %}
  {% if form.instance.id %}
    Editar Tweet
  {% else %}
    Nuevo Tweet
  {% endif %}
{% endblock title %}
{% block content %}
  <div class="row mb-4">
    <div class="col">
      <h1>
        {% if form.instance.id %}
          Editar Tweet
        {% else %}
          Crear Nuevo Tweet
        {% endif %}
      </h1>
    </div>
    <div class="col-auto">
      <a href="{% url 'tweet_list' %}" class="btn btn-secondary">Cancelar</a>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="{{ form.content.id_for_label }}" class="form-label">Contenido (m√°x. 280 caracteres)</label>
          {{ form.content.errors }}
          <textarea name="{{ form.content.name }}"
                    id="{{ form.content.id_for_label }}"
                    class="form-control"
                    rows="4"
                    maxlength="280"
                    required>{% if form.content.value %}{{ form.content.value }}{% endif %}</textarea>
          <div class="form-text" id="charCount">0/280 caracteres</div>
        </div>
        <div class="mb-3">
          <label for="{{ form.scheduled_time.id_for_label }}" class="form-label">Fecha y hora programada</label>
          {{ form.scheduled_time.errors }}
          <input type="datetime-local"
                 name="{{ form.scheduled_time.name }}"
                 id="{{ form.scheduled_time.id_for_label }}"
                 class="form-control"
                 value="{% if form.scheduled_time.value %}{{ form.scheduled_time.value|date:'Y-m-d\TH:i' }}{% endif %}" />
          <div class="form-text">Deja en blanco para no programar y guardar como borrador</div>
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>
  <script>
    // Contador de caracteres
    document.addEventListener('DOMContentLoaded', function() {
      const textarea = document.getElementById('{{ form.content.id_for_label }}');
      const charCount = document.getElementById('charCount');

      function updateCharCount() {
        const count = textarea.value.length;
        charCount.textContent = count + '/280 caracteres';

        if (count > 280) {
          charCount.classList.add('text-danger');
        } else {
          charCount.classList.remove('text-danger');
        }
      }

      textarea.addEventListener('input', updateCharCount);
      updateCharCount();
    });
  </script>
{% endblock content %}
