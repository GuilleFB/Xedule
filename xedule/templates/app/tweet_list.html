<!-- templates/app/tweet_list.html -->
{% extends 'base.html' %}

{% block title %}
  My Scheduled Tweets
{% endblock title %}
{% block content %}
  <div class="row mb-4">
    <div class="col">
      <h1 class="h4 fw-bold">My Scheduled Tweets</h1>
    </div>
    <div class="col-auto d-flex gap-2">
      <a href="{% url 'tweet_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> New Tweet
      </a>
      <a href="{% url 'tweet_bulk_upload' %}" class="btn btn-secondary">
        <i class="bi bi-upload"></i> Bulk Upload
      </a>
    </div>
  </div>
  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
          <label for="status" class="form-label">Status</label>
          <select name="status" id="status" class="form-select">
            <option value="">All statuses</option>
            <option value="pending"
                    {% if request.GET.status == 'pending' %}selected{% endif %}>Scheduled</option>
            <option value="published"
                    {% if request.GET.status == 'published' %}selected{% endif %}>Published</option>
            <option value="failed"
                    {% if request.GET.status == 'failed' %}selected{% endif %}>Failed</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="date_range" class="form-label">Date Range</label>
          <select name="date_range" id="date_range" class="form-select">
            <option value="">All dates</option>
            <option value="today"
                    {% if request.GET.date_range == 'today' %}selected{% endif %}>Today</option>
            <option value="tomorrow"
                    {% if request.GET.date_range == 'tomorrow' %}selected{% endif %}>Tomorrow</option>
            <option value="week"
                    {% if request.GET.date_range == 'week' %}selected{% endif %}>This week</option>
            <option value="month"
                    {% if request.GET.date_range == 'month' %}selected{% endif %}>This month</option>
          </select>
        </div>
        <div class="col-md-4">
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-funnel"></i> Filter
          </button>
        </div>
      </form>
    </div>
  </div>
  <!-- Tweets List -->
  <div class="card">
    <div class="card-body p-0">
      {% if tweets %}
        {% for tweet in tweets %}
          <div class="tweet-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <span class="tweet-color fw-bold">{{ tweet.user.username }}</span>
                <span class="text-muted">@{{ tweet.user.username }}</span>
                <span class="text-muted ms-2">Â· {{ tweet.created_at|date:"M j" }}</span>
              </div>
              <div>
                {% if tweet.status == 'pending' %}
                  <span class="tweet-status pending">Scheduled</span>
                {% elif tweet.status == 'published' %}
                  <span class="tweet-status published">Published</span>
                {% else %}
                  <span class="tweet-status failed">Failed</span>
                {% endif %}
              </div>
            </div>
            <p class="tweet-content">{{ tweet.content }}</p>
            {% if tweet.scheduled_time %}
              <div class="text-muted mb-2">
                <i class="bi bi-clock"></i> Scheduled for: {{ tweet.scheduled_time|date:"M j, Y, g:i a" }}
              </div>
            {% endif %}
            <div class="tweet-actions mt-2">
              <div>
                {% if tweet.status == 'pending' %}
                  <a href="{% url 'tweet_update' tweet.id %}"
                     class="text-decoration-none me-3 text-muted">
                    <i class="bi bi-pencil"></i>
                  </a>
                {% endif %}
                <a href="{% url 'tweet_delete' tweet.id %}"
                   class="text-decoration-none text-muted">
                  <i class="bi bi-trash"></i>
                </a>
              </div>
              {% if tweet.status == 'published' and tweet.x_id %}
                <a href="https://twitter.com/i/status/{{ tweet.x_id }}"
                   target="_blank"
                   class="text-decoration-none text-muted">
                  <i class="bi bi-box-arrow-up-right"></i> View on X
                </a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        <!-- Pagination -->
        <div class="p-3">{% include 'app/pagination.html' with page=tweets %}</div>
      {% else %}
        <div class="p-5 text-center">
          <p class="mb-4 text-muted">No tweets found</p>
          <a href="{% url 'tweet_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Create your first tweet
          </a>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}
